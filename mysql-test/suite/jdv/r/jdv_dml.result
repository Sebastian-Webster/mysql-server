CREATE TABLE t1(t1c1 INT PRIMARY KEY, t1c2 INT);
INSERT INTO t1 VALUES (0,0), (1,1), (2,2);
CREATE JSON DUALITY VIEW dv0 AS
SELECT JSON_DUALITY_OBJECT(
WITH (INSERT, UPDATE, DELETE)
"_id" : t1c1,
"kt1c2" : t1c2)
FROM t1;
SELECT * FROM dv0;
data
{"_id": 0, "kt1c2": 0, "_metadata": {"etag": "ec974eef84da06c8fc225f21ea139b79"}}
{"_id": 1, "kt1c2": 1, "_metadata": {"etag": "6966e3323782195471df738f91d8a3b1"}}
{"_id": 2, "kt1c2": 2, "_metadata": {"etag": "e612272fdb58935f3d593e83c7719385"}}
INSERT INTO dv0 VALUES ('{ "_id": 3, "kt1c2": 3}');
ERROR HY000: Feature not available in this edition.
UPDATE dv0 SET data = JSON_REPLACE(data, '$."kt1c2"', 6)
WHERE data->'$._id' = 2;
ERROR HY000: Feature not available in this edition.
DELETE FROM dv0 WHERE data->'$._id' = 2;
ERROR HY000: Feature not available in this edition.
DROP VIEW dv0;
DROP TABLE t1;
#
# Bug#37943451: sql_union.cc:503: bool Query_expression::optimize(THD *,
#  TABLE *, bool): Assertion `is_prepared() && !is_optimized()'
#
CREATE TABLE t1(id INT PRIMARY KEY, x INT, y INT);
INSERT INTO t1 VALUES (1,2,3), (2,3,4), (3,4,5);
CREATE JSON DUALITY VIEW v1 AS SELECT
JSON_DUALITY_OBJECT(
WITH(UPDATE, DELETE, INSERT)
'_id' : id,
'x' : x,
'y' : y)
FROM t1;
UPDATE v1,t1 SET DATA = '{"_id":1, "x":100, "y":200}' WHERE data->'$._id' = 1;
ERROR HY000: Feature not available in this edition.
DROP VIEW v1;
DROP TABLE t1;
